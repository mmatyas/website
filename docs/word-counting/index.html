<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"17896441":["/17896441.be24f435.css","/17896441.ae0246c6.js"],"main":["/main.240e98d9.css","/main.65fbe0e3.js"],"00389b4c":["/00389b4c.04fd8337.js"],"02dcd059":["/02dcd059.ba79f238.js"],"0664b817":["/0664b817.7e78fb99.js"],"0a0711cc":["/0a0711cc.bb98865b.js"],"0dffb83e":["/0dffb83e.db0d515f.js"],"0e384e19":["/0e384e19.ef81236a.js"],"12e33846":["/12e33846.09b622d6.js"],"191707d5":["/191707d5.44050f70.js"],"1a20bc57":["/1a20bc57.190ef683.js"],"1a9639fa":["/1a9639fa.e2bb1187.js"],"1be78505":["/1be78505.bfb710c1.css","/1be78505.c16ffd26.js"],"23d28cd9":["/23d28cd9.6e6be58a.js"],"25febcd3":["/25febcd3.911d6c11.js"],"29ae65e2":["/29ae65e2.b046c60b.js"],"2d28018b":["/2d28018b.c799dd53.js"],"368951d9":["/368951d9.71a9c2c7.js"],"390b1364":["/390b1364.e33ea747.js"],"3ad47acf":["/3ad47acf.433aa0a3.js"],"45cab17c":["/45cab17c.fdb0962f.js"],"47332f84":["/47332f84.77324446.js"],"4bb6b61a":["/4bb6b61a.2d4c0170.js"],"572aa7d9":["/572aa7d9.434a571f.js"],"57d941a4":["/57d941a4.56f73076.js"],"5f63e49f":["/5f63e49f.27048708.js"],"5fac913d":["/5fac913d.82245206.js"],"6583fe88":["/6583fe88.859acdd1.js"],"65b8ef03":["/65b8ef03.ba534891.js"],"6abcd51d":["/6abcd51d.c1675135.js"],"6ecc940f":["/6ecc940f.66526f80.js"],"6feee146":["/6feee146.a2f03f56.js"],"725923a1":["/725923a1.d8b995f5.js"],"75ba1e57":["/75ba1e57.7cc46122.js"],"7a6a101f":["/7a6a101f.91205252.js"],"81a3d97e":["/81a3d97e.89d44e40.js"],"86cdda1f":["/86cdda1f.51e656e2.js"],"89e076bb":["/89e076bb.cae9d8a4.js"],"8a22f3a9":["/8a22f3a9.26d360f8.js"],"8f46bd14":["/8f46bd14.ae46e24c.js"],"900b4027":["/900b4027.fcaa75d7.js"],"95862d62":["/95862d62.cabeee9e.js"],"99f5f98f":["/99f5f98f.2c4a0380.js"],"9c9e4252":["/9c9e4252.6084833e.js"],"9f381fe4":["/9f381fe4.f0bb2133.js"],"9fdac967":["/9fdac967.4fbdfc3b.js"],"a6aa9e1f":["/a6aa9e1f.19ebab33.css","/a6aa9e1f.15018cb9.js"],"aa833330":["/aa833330.17f4d6b1.js"],"ab14c11e":["/ab14c11e.fd825763.js"],"b07a9880":["/b07a9880.a24c26c9.js"],"b3ee200e":["/b3ee200e.8ba5ae96.js"],"b5108249":["/b5108249.796b0411.js"],"b58f8f06":["/b58f8f06.75c8bb5c.js"],"b5c0c0d4":["/b5c0c0d4.b937d13e.js"],"b79d5a32":["/b79d5a32.3e47c3c1.js"],"bc0aabf0":["/bc0aabf0.7a16f9b2.js"],"c0a642f2":["/c0a642f2.967bf602.js"],"c4f5d8e4":["/c4f5d8e4.b4d54b7a.css","/c4f5d8e4.2395b07e.js"],"c8101975":["/c8101975.fd3eb8c8.js"],"cbb4eec4":["/cbb4eec4.0e95ec5e.js"],"ccb1f900":["/ccb1f900.9afb2f33.js"],"ccc49370":["/ccc49370.19ebab33.css","/ccc49370.24a1638f.js"],"cea3909d":["/cea3909d.d1e4ec5e.js"],"ceed58b9":["/ceed58b9.81ba0056.js"],"d477aa06":["/d477aa06.e7e9a930.js"],"d589d3a7":["/d589d3a7.c670af47.js"],"d7b8612d":["/d7b8612d.2e078997.js"],"d85e8376":["/d85e8376.419c555d.js"],"e62825d3":["/e62825d3.8f500a38.js"],"e8493891":["/e8493891.4baacd49.js"],"e85a5910":["/e85a5910.27380df6.js"],"f0520b28":["/f0520b28.62b16d87.js"],"fb3d97e4":["/fb3d97e4.8949c272.js"]};/*]]>*/</script>

<title data-react-helmet="true">Word Counting</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" property="og:title" content="Neon · Fast and Safe Native Node.js Modules"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="description" content="In this guide we&#x27;re going to recreate the [word counting demo Dave Herman gave in his talk about neon](https://youtu.be/jINMIAicaS0?t=789)."/><meta data-react-helmet="true" property="og:description" content="In this guide we&#x27;re going to recreate the [word counting demo Dave Herman gave in his talk about neon](https://youtu.be/jINMIAicaS0?t=789)."/><meta data-react-helmet="true" property="og:url" content="https://neon-bindings.com/docs/word-counting"/>

<link data-react-helmet="true" rel="shortcut icon" href="/logo/letter-logo.png"/>


<link rel="stylesheet" type="text/css" href="/main.240e98d9.css" />

<link rel="stylesheet" type="text/css" href="/0.72d8e17b.css" />

<link rel="stylesheet" type="text/css" href="/1.fccaec0e.css" />

<link rel="stylesheet" type="text/css" href="/1be78505.bfb710c1.css" />

<link rel="stylesheet" type="text/css" href="/17896441.be24f435.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/logo/letter-logo.png" alt="Neon Logo"/><strong class="">Neon</strong></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/neon-bindings/examples#table-of-contents">Examples</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="/api/neon/">API</a><a class="navbar__item navbar__link" href="/docs/learning-resources">Resources</a><a class="navbar__item navbar__link" href="/docs/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/neon-bindings/neon">GitHub</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"/></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/logo/letter-logo.png" alt="Neon Logo"/><strong>Neon</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/neon-bindings/examples#table-of-contents">Examples</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="/api/neon/">API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learning-resources">Resources</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/neon-bindings/neon">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/hello-world">Hello World!</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/cli">CLI</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/primitives">Primitives</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/arrays">Arrays</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/objects">Objects</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/arguments">Arguments</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/type-checking">Type Checking</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/functions">Functions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/classes">Classes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/modules">Modules</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/json">JSON</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/errors">Errors</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/async">Async Tasks</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/electron-apps">Electron Apps</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/publishing">Publishing</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/word-counting">Word Counting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/tooling">Tooling</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/example-projects">Who&#x27;s Using Neon</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/learning-resources">Learning Resources</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Word Counting</h1></header><div class="markdown"><p>In this guide we&#x27;re going to recreate the <a href="https://youtu.be/jINMIAicaS0?t=789">word counting demo Dave Herman gave in his talk about neon</a>.</p><p>First start by creating a new project with <code>neon-cli</code>:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-bash codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">neon new hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> hello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># OR `yarn install`</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">node -e </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;require(&quot;./&quot;)&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>When installing the dependencies, npm will run <code>neon build --release</code> and build a release build of our code in <code>./native</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="i-take-thee-at-thy-word"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#i-take-thee-at-thy-word">#</a>I Take Thee at thy Word</h2><p>To illustrate what you can do with Neon, we will a little word counting demo. The demo is simple: read in the complete plays of Shakespeare and count the total number of occurrences of the word “thee”. First lets implement this demo in pure JS. The top-level code splits the corpus into lines, and sums up the counts for each line:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-js codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">corpus</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ls </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">lines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">corpus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> n </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    total </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">wcLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Searching an individual line involves splitting the line up into word and matching each word against the search string:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-js codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">wcLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">line</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> words </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> n </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> words</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">matches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">words</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      total</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>The rest of the details are pretty straightforward but definitely check out the code—it’s small and self-contained.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="fall-into-our-rustic-revelry"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#fall-into-our-rustic-revelry">#</a>Fall Into our Rustic Revelry</h2><p>One of the amazing things about Rust is that highly efficient code can still be remarkably compact and readable. In the Rust version of the algorithm, the code for summing up the counts for all the lines looks pretty similar to the JS code:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">mut</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> word </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token char string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">matches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">word</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        total </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">total </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// in Rust you can omit `return` for a trailing expression</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>In fact, that same code can be written at a higher level of abstraction without losing performance, using iteration methods like filter and fold (similar to Array.prototype.filter and Array.prototype.reduce in JS):</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token char string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">word</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">matches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">word</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">sum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> sum </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>In my quick experiments, that even seems to shave a few milliseconds off the total running time. I think this is a nice demonstration of the power of Rust’s zero-cost abstractions, where idiomatic and high-level abstractions produce the same or sometimes even better performance (by making additional optimizations possible, like eliminating bounds checks) than lower-level, more obscure code.</p><p>On my machine, the simple Rust translation runs in about 80 – 85ms. Not bad—about 3x as fast just from using Rust, and in roughly the same number of lines of code (60 in JS, 70 in Rust). By the way, I’m being approximate here with the numbers, because this isn’t a remotely scientific benchmark. My goal is just to demonstrate that you can get significant performance improvements from using Rust; in any given situation, the particular details will of course matter.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="their-thread-of-life-is-spun"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#their-thread-of-life-is-spun">#</a>Their Thread of Life is Spun</h2><p>We’re not done yet, though! Rust enables something even cooler for Node: we can easily and safely parallelize this code—and I mean without the night-sweats and palpitations usually associated with multithreading. Here’s a quick look at the top level logic in the Rust implementation of the demo:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">borrow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token closure-params punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token closure-params">data</span><span class="token closure-params punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> corpus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">from_utf8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">as_slice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unwrap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">wc_parallel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token function" style="color:rgb(130, 170, 255)">lines</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">corpus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>The <code>cx.borrow</code> API lets Neon safely expose the raw bytes of a Node Buffer object (i.e., a typed array) to Rust threads, by preventing JS from running in the meantime. And Rust’s concurrency model makes programming with threads actually fun.</p><p>To demonstrate how easy this can be, I used Niko Matsakis’s new Rayon crate of beautiful data parallelism abstractions. Changing the demo to use Rayon is as simple as replacing the into_iter/map/fold/ lines above with:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-diff codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted">+   lines.into_par_iter()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted"></span><span class="token unchanged">      .map(|line| wc_line(line, search))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token unchanged">      .sum()</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p>Keep in mind, Rayon wasn’t designed with Neon in mind—its generic primitives match the iteration protocols of Rust, so Neon was able to just pull it off the shelf.</p><p>With that simple change, on my two-core MacBook Air, the demo goes from about 85ms down to about 50ms.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="bridge-most-valiantly-with-excellent-discipline"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#bridge-most-valiantly-with-excellent-discipline">#</a>Bridge Most Valiantly, with Excellent Discipline</h2><p>I’ve worked on making the integration as seamless as possible. From the Rust side, Neon functions follow a simple protocol, taking a Call object and returning a JavaScript value:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-rust codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">search</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">mut</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> FunctionContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-&gt;</span><span class="token plain"> JsResult</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">JsNumber</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">Ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">total</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><p><code>cx</code>, a <code>FunctionContext</code> struct, safely tracks handles into V8’s garbage-collected heap. The Neon API uses the Rust type system to guarantee that your native module can’t crash your app by mismanaging object handles.</p><p>From the JS side, loading the native module is straightforward:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_3ZcX"><pre class="prism-code language-js codeBlock_1wn8" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> myNeonModule </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;neon-bridge&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="wherefores-this-noise"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#wherefores-this-noise">#</a>Wherefore’s this Noise?</h2><p>I hope this demo is enough to get people interested. Beyond the sheer fun of it, I think the strongest reasons for using Rust in Node are performance and parallelism. As the Rust ecosystem grows, it’ll also be a way to give Node access to cool Rust libraries. Beyond that, I’m hoping that Neon can make a nice abstraction layer that just makes writing native Node modules less painful. With projects like node-uwp it might even be worth exploring evolving Neon towards a JS-engine-agnostic abstraction layer.</p><p>There are lots of possibilities, but I need help! If you want to get involved, I’ve created a community slack (grab an invite from the Slackin app) and a #neon IRC channel on Mozilla IRC (irc.mozilla.org).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="source"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#source">#</a>Source</h2><p>Here is the <a href="https://github.com/neon-bindings/examples/tree/master/word-counting">source code</a> for this guide.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/publishing"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« <!-- -->Publishing</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/tooling"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Tooling<!-- --> »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#i-take-thee-at-thy-word" class="contents__link">I Take Thee at thy Word</a></li><li><a href="#fall-into-our-rustic-revelry" class="contents__link">Fall Into our Rustic Revelry</a></li><li><a href="#their-thread-of-life-is-spun" class="contents__link">Their Thread of Life is Spun</a></li><li><a href="#bridge-most-valiantly-with-excellent-discipline" class="contents__link">Bridge Most Valiantly, with Excellent Discipline</a></li><li><a href="#wherefores-this-noise" class="contents__link">Wherefore’s this Noise?</a></li><li><a href="#source" class="contents__link">Source</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" label="Getting Started" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" label="Examples" url="https://github.com/neon-bindings/examples">Examples</a></li><li class="footer__item"><a class="footer__link-item" label="API Reference" to="https://neon-bindings.com/api/neon/index.html" href="https://neon-bindings.com/api/neon/index.html">API Reference</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" label="Community Chat" url="https://rust-bindings-slackin.herokuapp.com">Community Chat</a></li><li class="footer__item"><a class="footer__link-item" label="Twitter" to="https://twitter.com/rustneon" href="https://twitter.com/rustneon">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" label="GitHub" to="https://github.com/neon-bindings/neon" href="https://github.com/neon-bindings/neon">GitHub</a></li></ul></div></div><div class="text--center logoContainer_c2nu"><div class="margin-bottom--sm"><img class="footer__logo" alt="Neon Logo" src="/logo/text-logo.svg"/></div><div class="sponsor_2a7p"><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="netlify sponsor"/></a></div>Copyright © 2019 Neon Bindings</div></div></footer>
</div>

<script type="text/javascript" src="/runtime~main.04bcc6c7.js"></script>

<script type="text/javascript" src="/main.65fbe0e3.js"></script>

<script type="text/javascript" src="/0.173ade14.js"></script>

<script type="text/javascript" src="/1.18149738.js"></script>

<script type="text/javascript" src="/1be78505.c16ffd26.js"></script>

<script type="text/javascript" src="/9c9e4252.6084833e.js"></script>

<script type="text/javascript" src="/17896441.ae0246c6.js"></script>

<script type="text/javascript" src="/99f5f98f.2c4a0380.js"></script>

<script type="text/javascript" src="/b5c0c0d4.b937d13e.js"></script>

</body>
</html>